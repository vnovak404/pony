// Pony Parade: actor renderer wiring.

import { createActorRenderer } from "./actors.js";

export const createActorPipeline = ({
  ctx,
  mapData,
  ASSET_SCALE,
  actors,
  statusIcons,
  getScale,
  getLastPointer,
  isLabelsEnabled,
  commandMenu,
  houseState,
  innObject,
  spotIndex,
  spotHelpers,
  accessPoints,
  roadNetwork,
  taskHelpers,
  needHelpers,
  supplyProducers,
  inventory,
  vfxState,
  getSpotOffset,
  config,
  supplyConfig,
}) => {
  const {
    HUNGER_RATE,
    THIRST_RATE,
    BOREDOM_RATE,
    HEALTH_DECAY_RATE,
    HEALTH_THRESHOLD_DEFAULT,
    EAT_THRESHOLD_DEFAULT,
    DRINK_THRESHOLD_DEFAULT,
    BOREDOM_THRESHOLD_DEFAULT,
    EAT_RADIUS_TILES,
    EAT_DURATION_MIN,
    EAT_DURATION_MAX,
    EAT_COOLDOWN_MIN,
    EAT_COOLDOWN_MAX,
    DRINK_RADIUS_TILES,
    DRINK_DURATION_MIN,
    DRINK_DURATION_MAX,
    DRINK_COOLDOWN_MIN,
    DRINK_COOLDOWN_MAX,
    WORK_RADIUS_TILES,
    WORK_DURATION_PER_ITEM_MIN,
    WORK_DURATION_PER_ITEM_MAX,
    WORK_ACTION_DURATION_MAX,
    WORK_COOLDOWN_MIN,
    WORK_COOLDOWN_MAX,
    WORK_RESTOCK_MIN,
    WORK_RESTOCK_MAX,
    WORK_RESTOCK_THRESHOLD,
    FUN_RADIUS_TILES,
    FUN_DURATION_MIN,
    FUN_DURATION_MAX,
    FUN_COOLDOWN_MIN,
    FUN_COOLDOWN_MAX,
    VET_RADIUS_TILES,
    VET_DURATION_MIN,
    VET_DURATION_MAX,
    VET_COOLDOWN_MIN,
    VET_COOLDOWN_MAX,
    REPAIR_DURATION_MIN,
    REPAIR_DURATION_MAX,
    MANUAL_SPEED_MULTIPLIER,
    ACTOR_STUCK_TIMEOUT,
  } = config;

  const {
    SUPPLY_RECIPES_BY_LOCATION,
    SUPPLY_RECIPES_BY_TYPE,
    PRODUCER_INGREDIENT_OUTPUTS,
    INGREDIENT_WORK_DURATION_MULTIPLIERS,
    INGREDIENT_RESTOCK_MULTIPLIERS,
    INGREDIENT_ICON_MAP,
    INGREDIENT_SUPPLY_TYPES,
    INGREDIENT_DESTINATIONS,
    UNLIMITED_INGREDIENTS,
  } = supplyConfig;

  const { drawActors } = createActorRenderer({
    ctx,
    mapData,
    ASSET_SCALE,
    actors,
    statusIcons,
    getScale,
    getLastPointer,
    isLabelsEnabled,
    resolveTaskLabel: commandMenu.resolveTaskLabel,
    releaseInnSpot: houseState.releaseInnSpot,
    releaseHouseSpot: houseState.releaseHouseSpot,
    claimInnSpot: houseState.claimInnSpot,
    claimHouseSpot: houseState.claimHouseSpot,
    innSleepSpots: houseState.innSleepSpots,
    housesById: houseState.housesById,
    houseStates: houseState.houseStates,
    innObject,
    foodSpotById: spotIndex.foodSpotById,
    drinkSpotById: spotIndex.drinkSpotById,
    funSpotById: spotIndex.funSpotById,
    healthSpotById: spotIndex.healthSpotById,
    foodSpots: spotIndex.foodSpots,
    drinkSpots: spotIndex.drinkSpots,
    funSpots: spotIndex.funSpots,
    healthSpots: spotIndex.healthSpots,
    getSpotInventory: inventory.getSpotInventory,
    getIngredientEntry: inventory.getIngredientEntry,
    consumeIngredients: inventory.consumeIngredients,
    consumeSpotInventory: inventory.consumeSpotInventory,
    restockSpotInventory: inventory.restockSpotInventory,
    restockIngredient: inventory.restockIngredient,
    supplyProducers,
    getSpotForLocationId: taskHelpers.getSpotForLocationId,
    getSupplySourceForType: taskHelpers.getSupplySourceForType,
    getSupplySpotAccessPoint: accessPoints.getSupplySpotAccessPoint,
    getSupplyTypesForSpot: spotHelpers.getSupplyTypesForSpot,
    getHouseTargetPoint: accessPoints.getHouseTargetPoint,
    getFoodSpotAccessPoint: accessPoints.getFoodSpotAccessPoint,
    getDrinkSpotAccessPoint: accessPoints.getDrinkSpotAccessPoint,
    getFunSpotAccessPoint: accessPoints.getFunSpotAccessPoint,
    getHealthSpotAccessPoint: accessPoints.getHealthSpotAccessPoint,
    getSpotOffset,
    findRepairTarget: houseState.findRepairTarget,
    getCriticalNeedTask: needHelpers.getCriticalNeedTask,
    pickNeedCandidate: needHelpers.pickNeedCandidate,
    pickFoodSpot: needHelpers.pickFoodSpot,
    pickDrinkSpot: needHelpers.pickDrinkSpot,
    pickFunSpot: needHelpers.pickFunSpot,
    pickHealthSpot: needHelpers.pickHealthSpot,
    getTaskTargetPoint: taskHelpers.getTaskTargetPoint,
    snapActorToNearestSegment: roadNetwork.snapActorToNearestSegment,
    findNearestRoadTile: roadNetwork.findNearestRoadTile,
    buildTilePath: roadNetwork.buildTilePath,
    tileKey: roadNetwork.tileKey,
    advanceAlongPath: roadNetwork.advanceAlongPath,
    isOffMap: roadNetwork.isOffMap,
    endpointIndex: roadNetwork.endpointIndex,
    endpointKey: roadNetwork.endpointKey,
    pickNextSegment: roadNetwork.pickNextSegment,
    roadSegments: roadNetwork.roadSegments,
    vfxByKey: vfxState.vfxByKey,
    vfxVideos: vfxState.vfxVideos,
    VFX_REGISTRY: vfxState.VFX_REGISTRY,
    setVideoActive: vfxState.setVideoActive,
    drawVideoOverlay: vfxState.drawVideoOverlay,
    lakeState: vfxState.lakeState,
    isFoodSpot: spotHelpers.isFoodSpot,
    isDrinkSpot: spotHelpers.isDrinkSpot,
    isFunSpot: spotHelpers.isFunSpot,
    isSupplySpot: spotHelpers.isSupplySpot,
    SUPPLY_RECIPES_BY_LOCATION,
    SUPPLY_RECIPES_BY_TYPE,
    PRODUCER_INGREDIENT_OUTPUTS,
    INGREDIENT_WORK_DURATION_MULTIPLIERS,
    INGREDIENT_RESTOCK_MULTIPLIERS,
    INGREDIENT_ICON_MAP,
    INGREDIENT_SUPPLY_TYPES,
    INGREDIENT_DESTINATIONS,
    UNLIMITED_INGREDIENTS,
    HUNGER_RATE,
    THIRST_RATE,
    BOREDOM_RATE,
    HEALTH_DECAY_RATE,
    HEALTH_THRESHOLD_DEFAULT,
    EAT_THRESHOLD_DEFAULT,
    DRINK_THRESHOLD_DEFAULT,
    BOREDOM_THRESHOLD_DEFAULT,
    EAT_RADIUS_TILES,
    EAT_DURATION_MIN,
    EAT_DURATION_MAX,
    EAT_COOLDOWN_MIN,
    EAT_COOLDOWN_MAX,
    DRINK_RADIUS_TILES,
    DRINK_DURATION_MIN,
    DRINK_DURATION_MAX,
    DRINK_COOLDOWN_MIN,
    DRINK_COOLDOWN_MAX,
    WORK_RADIUS_TILES,
    WORK_DURATION_PER_ITEM_MIN,
    WORK_DURATION_PER_ITEM_MAX,
    WORK_ACTION_DURATION_MAX,
    WORK_COOLDOWN_MIN,
    WORK_COOLDOWN_MAX,
    WORK_RESTOCK_MIN,
    WORK_RESTOCK_MAX,
    WORK_RESTOCK_THRESHOLD,
    FUN_RADIUS_TILES,
    FUN_DURATION_MIN,
    FUN_DURATION_MAX,
    FUN_COOLDOWN_MIN,
    FUN_COOLDOWN_MAX,
    VET_RADIUS_TILES,
    VET_DURATION_MIN,
    VET_DURATION_MAX,
    VET_COOLDOWN_MIN,
    VET_COOLDOWN_MAX,
    REPAIR_DURATION_MIN,
    REPAIR_DURATION_MAX,
    MANUAL_SPEED_MULTIPLIER,
    ACTOR_STUCK_TIMEOUT,
  });

  return { drawActors };
};
